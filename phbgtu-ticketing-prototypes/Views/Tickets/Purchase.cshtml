
@{
    ViewData["Title"] = "Purchase";
}

        <h2>Purchase</h2>

            <script src="https://www.paypalobjects.com/api/checkout.js"></script>

<div class="form-wrapper">
    <form method="post" action="" enctype="multipart/form-data">
        <fieldset id="ticket-quantity" class="form-horizontal">
            <legend>{eventName} Ticket Purchase</legend>
            <div class="control-group">
                <label class="control-label"><strong>Tickets are $5 dollars for the selected event</strong></label>
                <br />                
                <label class="control-label" for="numTickets"><strong>How many tickets would you like to buy?</strong></label>
                <br/>
                <br/>
                <div class="controls">
                    <select name="numTickets"></select>
                </div>
            </div>
        </fieldset>
        <fieldset id="ticket-data" class="form-horizontal">
            <legend>Attendee Details</legend>
            <div id="attendee-data">
                <div class="control-group attendee-field" id="attendeeField1">
                    <label class="control-label" for="attendeeName[1]"><strong>Attendee #1's name</strong></label>
                    <div class="controls">
                        <input name="attendeeName[1]" type="text" class="input input-large">
                    </div>
                    
                </div>
            </div>
            <br />
            <label class="control-label"><strong>This is your price:</strong></label>
            <p id="price"></p>
            <br />
            <br/>
            <div id="paypal-button"></div> 

            <script>
                paypal.Button.render({

                    env: 'sandbox', // Or 'sandbox', 'production'

                    client: {
                        sandbox: 'ATjufowsvc1ggtf5vMdvG1c9PdEo22wYdm3HgeLpV6gMiRcY6frfEwNzYzbdYZ-iJpawqJC9Ts4HlriJ',
                        production: '<insert production client id>'
                    },

                    commit: true, // Show a 'Pay Now' button

                    payment: function (data, actions) {
                        // Set up the payment here
                        return actions.payment.create({
                            payment: {
                                transactions: [
                                    {
                                        amount: { total: calculatePrice(), currency: 'USD' }

                                    }
                                ]
                            }
                        });
                    },

                    onAuthorize: function (data, actions) {
                        // Execute the payment here
                        return actions.payment.execute().then(function () {
                            window.alert('Payment Complete!');
                        });
                    }

                }, '#paypal-button');
            </script>
        </fieldset>

    </form>
</div>

<link rel="stylesheet" href="bootstrap.css" />
<style>
    .form-wrapper {
        width: 75%;
        margin: auto;
    }

    .form-horizontal {
        border: 1px solid black;
        padding: 15px;
    }

        .form-horizontal legend {
            border-color: inherit;
            text-align: center;
        }

    .hidden {
        display: none;
    }
</style>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript">
    $(function () { 
        $("#ticket-data").addClass("hidden");   //This is the code that was added for temp fix 
    });
$(function()
{
		var maxTicketsPerCustomer = 100;
        var option = "<option value=\"{#}\">{#}</option>";
        $("select[name=numTickets]").append(option.replace(/\{#\}/g, ' '));
		for (var i = 1; i < maxTicketsPerCustomer; i++)
		{
			$("select[name=numTickets]").append(option.replace(/\{#\}/g, i));
        }
        $("select[name=numTickets]").change();
               
	}
    );

function getAttendeeField(index)
{
	var attendeeFieldContent = [
		'<div class="control-group attendee-field" id="attendeeField{#}">',
			'<label class="control-label" for="attendeeName[{#}]"><strong>Attendee #{#}\'s name</strong></label>',
			'<div class="controls">',
				'<input name="attendeeName[{#}]" type="text" class="input input-large">',
			'</div>',
		'</div>'
	];

	return attendeeFieldContent.join("").replace(/\{#\}/g, index);
    }
    var PayPalFinalAmount = 0;  //used to globally get the amount of attendees 
$("select[name=numTickets]").change(function()
{
    
		var attendeeFields = $(".attendee-field");
		var attendeeFieldCount = attendeeFields.length;
        var attendeeCount = $("option:selected", this).val();
        document.getElementById("price").innerHTML = "$" + (attendeeCount * 5);
        PayPalFinalAmount = (attendeeCount * 5);
       
		if (attendeeCount == 0)
			$("#ticket-data").addClass("hidden");
		else
			$("#ticket-data").removeClass("hidden");

		if (attendeeFieldCount < attendeeCount)
		{
			for (var i = attendeeFieldCount; i < attendeeCount; i++)
			{
				$("#attendee-data").append(getAttendeeField(i+1));
			}
		}
		else if (attendeeFieldCount > attendeeCount)
		{
			for (var i = attendeeFieldCount; i >= attendeeCount; i--)
			{
				$("#attendeeField" + (i+1)).remove();
			}
        }        
}

    );

    function calculatePrice() {
        var attendeeCount = $("option:selected", this).val();
        var CountAfterMath = (attendeeCount * 5);
        var FinalCount = (PayPalFinalAmount + ".00").toString();
        return FinalCount;
    }   

</script>